# 🤖 AI 小智项目面试高频题库（精选版）

## 一、 硬件接口与选型层

### 1. I2C 与 I2S 的区别是什么？为什么 ES8311 要同时用到这两个接口？

- **答案：** I2C 是控制通道（低速），用于配置 ES8311 内部的寄存器，比如设置音量、采样率和使能芯片。I2S 是音频数据通道（高速），专门负责传输数字音频的 PCM 原始采样数据。
- **面试加分：** 这种设计实现了“控制与数据分离”，确保在播放音频时，依然可以实时通过 I2C 调整音量或静音。

### 2. 你在初始化时创建的 `gpio_if` 和 `pa_pin` 有什么用？

- **答案：** `pa_pin` 对应硬件上的功放（Power Amplifier）使能引脚（项目里是 GPIO 7）。`gpio_if` 是驱动框架提供的操作接口。
- **逻辑：** 为了防止开机瞬间出现“砰砰”声（Pop Noise）并节省功耗，只有在调用 `open` 开始播放音频时，驱动才会自动通过这个接口拉高引脚开启功放；调用 `close` 时则自动关闭。

### 3. 为什么选择 ESP32-S3 作为主控？

- **答案：** S3 拥有 240MHz 的主频和 512K RAM，性能强劲。
- **核心原因：** 它内置了 Wi-Fi 和蓝牙，极大方便了 AI 机器人的联网配网。此外，S3 拥有专用的 AI 向量指令集，能加速我们项目中用到的 Opus 软件编解码算法。

------

## 二、 软件架构与 RTOS 任务

### 4. 请详细描述 `feed_task` 和 `fetch_task` 之间的协同关系。

- **答案：** 这是一个典型的“生产者-消费者”模型。`feed_task` 负责持续从硬件采集 PCM 音频并存入环形缓冲区。`fetch_task` 则负责从缓冲区取出数据交给 Opus 编码器。
- **意义：** 使用 Ringbuffer（环形缓冲区）可以有效平滑网络波动或编码计算带来的耗时抖动，防止音频数据丢失或卡顿。

### 5. 如果缓冲区溢出了怎么办？

- **答案：** 这种情况说明“生产”快于“消费”。在嵌入式开发中，通常有两种处理策略：一是覆盖旧数据（确保数据的实时性），二是阻塞等待（确保数据的完整性）。在本项目中，优先保证语音流的实时性，若缓冲区满，通常会舍弃部分旧数据。

------

## 三、 音频流处理与网络协议

### 6. ES8311 是如何处理 Opus 格式的？

- **答案：** **这是一个陷阱题。** ES8311 芯片本身不具备处理 Opus 的能力，它只负责 PCM 数字信号与模拟电压信号的转换。
- **修正：** PCM 到 Opus 的压缩编码是在 **ESP32-S3 的 CPU 上通过软件算法完成的**，这样可以将体积压缩约 10 倍，便于 WebSocket 传输。

### 7. 下行链路中，如何区分收到的数据是音频还是 JSON 指令？

- **答案：** 在 `App_Communication_WebsocketReceiveHandle` 回调函数中，通过判断 `type` 字段实现。
- **逻辑：** 如果 `type == WEBSOCKET_TEXT_DATA`，则将其作为 JSON 文本解析（如 tts、iot 指令）；否则作为二进制音频数据，直接丢入解码缓冲区。

### 8. 你的项目中是如何实现“语音转文字（STT）”回显的？

- **答案：** 实际上，识别到的文字是封装在 `tts` 协议的 `sentence_start` 状态下的。
- **代码体现：** 当解析到 `state` 为 `sentence_start` 时，从 JSON 中提取 `text` 字段，并调用 `App_Display_SetContentText` 将文字刷新到 LVGL 屏幕上。

------

## 四、 业务逻辑与系统健壮性

### 9. 你的 IOT 控制逻辑是如何设计的？

- **答案：** 通过解析云端下发的 `iot` 类型 JSON 数据。
- **实现：** 解析出 `commands` 数组中的 `method`（方法名）和 `parameters`（参数），然后匹配对应的回调函数，比如 `SetVolume` 去调音量，`OpenLamp` 去控制 LED 引脚。

### 10. WebSocket 断开了怎么处理？

- **答案：** 项目中创建了一个专门的 `ReconnectTask`（重连任务）。
- **机制：** 该任务会监听连接状态事件组。一旦断开，它会尝试重新建立连接，并在成功后重新发送 `hello` 握手包以获取新的 `session_id`，恢复交互链路。